# Swift-Bluetooth DEMO

### 前言
文本打印的优缺点：
优点：
  1、打印出的面单，字体啥的较清晰
  2、打印速度快
缺点：涉及本地化
  1、目前新添一门语言面临打印机是否兼容其字库，不兼容的情况下，供应商兼容了每台打印机都要升级固体及字库，如果后期连续新添其他的语言，打印机不一定能兼容得了，字库也会爆表表不说， 面单维护也是个问题
  2、测试面临一个问题：由于开发、产品及测试对新添的语言不认识，测试的时候，发现不了问题，以及测试环境做不到全部覆盖使用场景，也是出于对当地人文环境不太了解
  3、打印机供应商那边排序解决问题，更新字库到对接测试所需时间成本也高
  
图片打印的优缺点：
优点：
  1、图片数据大，蓝牙下发慢，通过压缩后，下发速度加快，打整张图片控制在所需3-5秒之内出纸，用户体验佳
  2、因为是无损压缩，数据不会受到影响，保证图片质量
缺点：
  1、打印机要支持ZLib、Lzo相关压缩算法，不支持压缩算法打印图片，图片数据量大，蓝牙下发速度慢，出纸所花时间为7秒甚至十几秒、几十秒不等，全程看打印机的脾气，用户体验不佳
  
注意点：打印纸的尺寸是76*130mm、绘制图片UI的时候规格大小，像素1：1对上，方可保证打印出图片像素不失真；图片压缩控制在5-10k(1个字节存8个像素）

图片打印三步骤：
  1、第一步后端统一维护排版【或者本地绘制面板】
  2、第二步：生成图片
  3、第三步图片转指令并打印
  
## 一、实现框架
![image](https://user-images.githubusercontent.com/18625637/185573238-740c668d-6076-48de-84a1-f0f7c762fb6e.png)

## 二、支持的蓝牙打印机
这个根据你自己的业务来匹配

## 三、模块功能
  1、BluetoothManager：对CoreBluetooth的封装，控制蓝牙连接
  2、BLuetoothObject：蓝牙状态管理，触发视图更新
  3、打印机列表存储于CoreData
  4、BluetoothPrintMode：打印模式类型的封装，PDF打印(PDF to image)、图片打印、CPCL打印
  
## 四、面单模块
  1、FaceSheetView：页面布局，临时视图转图像（使用CoreGraphics转换）
  2、BarCode：二维码扫描和生成
  3、ZLib、Lzo：图像压缩算法
  4、PDFUtils：图像PDF编码
  5、PrinterManager：CPCL代码组装
  
### 注意点：
  1、绘制打印面单的尺寸：576*1000，规则写死，点对点传输，原始分辨率与打印机的分辨率匹配。防止像素的损失
  2、PDF绘制面单水印颜色使用浅淡色灰色值
